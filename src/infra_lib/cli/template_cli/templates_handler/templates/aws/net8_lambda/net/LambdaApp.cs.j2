using System;
using System.Threading.Tasks;
using Amazon.Lambda.Core;
using Amazon.Lambda.APIGatewayEvents;
using System.Text.Json;

[assembly: LambdaSerializer(typeof(Amazon.Lambda.Serialization.SystemTextJson.DefaultLambdaJsonSerializer))]

namespace {{ project_name }}
{
    public class LambdaApp
    {
        public async Task<APIGatewayProxyResponse> HandlerAsync(APIGatewayProxyRequest request)
        {
            string env = EnvironmentSettings.Instance.CurrentEnvironment.ToString();
            var secretNames = new List<string>
            {
                "secret_example"
            };

            var secretsDict = new Dictionary<string, object>();
            foreach (var name in secretNames)
            {
                secretsDict[name] = await SecretsManagerUtil.GetSecretAsync(name);
            }


            var responseBody = new
            {
                result = "test",
                environment = env,
                secrets = secretsDict
            };


            return new APIGatewayProxyResponse
            {
                StatusCode = 200,
                Body = JsonSerializer.Serialize(responseBody),
                Headers = new Dictionary<string, string> { { "Content-Type", "application/json" } }
            };
        }
    }
}
